<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุตูุญุฉ ูุจูุท ุงุญุชุฑุงููุฉ - ุชูุตูู ูุฌุงูู ุนูู 2 ููุชุฌ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* Custom Styles for RTL and Design */
        body {
            font-family: 'Inter', Arial, sans-serif;
            background-color: #f7f7f7;
            scroll-behavior: smooth;
        }
        .container {
            max-width: 900px;
        }
        /* ุงูุดุฑูุท ุงูุนููู ุงูุซุงุจุช */
        #sticky-offer-bar {
            position: sticky;
            top: 0;
            z-index: 50;
        }
        /* ุจุทุงูุงุช ุงูููุฏููุงุช - Border Blue */
        .model-card {
            transition: transform 0.2s, box-shadow 0.2s, border-color 0.2s;
            cursor: pointer;
            border: 3px solid transparent;
        }
        .model-card.active {
            border-color: #2563EB; /* Blue-600 */
            box-shadow: 0 4px 10px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.1);
        }
        /* ุถูุงู ุงุฑุชูุงุน ูุชูุงุณู ููุจุทุงูุงุช ุจุงุณุชุฎุฏุงู flex */
        .model-card-content {
            display: flex;
            flex-direction: column;
            height: 100%; /* ุชุฃูุฏ ูู ุฃู ุงููุญุชูู ูููุฃ ุงูุจุทุงูุฉ ุจุงููุงูู */
            justify-content: space-between; /* ุฏูุน ุนูุงุตุฑ ุงูุชุญูู ุจุงููููุฉ ููุฃุณูู */
        }

        /* ุฃุฒุฑุงุฑ ุงููููุฉ */
        .qty-btn {
            color: white;
            transition: background-color 0.1s;
        }
        .qty-btn:disabled {
            background-color: #9ca3af !important; 
            cursor: not-allowed;
        }
        /* ุดุฑูุท ุงูุชูุฏู */
        #progress-bar-fill {
            transition: width 0.4s ease-in-out, background-color 0.4s;
        }
        /* ููุฎุต ุงูุทูุจ - Summary Box Border */
        .summary-box {
            border: 2px solid #2563EB; /* Blue-600 border for emphasis */
            background-color: #EFF6FF; /* Blue-50 light background */
        }
        
        /* Mobile adjustment for form/summary layout */
        @media (min-width: 768px) {
            .form-grid {
                grid-template-columns: 2fr 1.5fr;
            }
        }
        /* Carousel Styles */
        .carousel-item {
            display: none;
            width: 100%;
            height: 100%;
        }
        .carousel-item.active {
            display: block;
        }

        /* ุงูุฒุฑ ุงูุนุงุฆู (Sticky CTA) */
        #floating-cta-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 40; 
            padding: 1rem;
            background: linear-gradient(to top, rgba(243, 244, 246, 1), rgba(243, 244, 246, 0.8));
            backdrop-filter: blur(2px);
            border-top: 1px solid #e5e7eb;
            transform: translateY(100%);
            transition: transform 0.3s ease-in-out, opacity 0.3s;
            opacity: 0;
        }
        
        #floating-cta-container.visible {
            transform: translateY(0);
            opacity: 1;
        }

        /* ุฅุฎูุงุก ุงูุฒุฑ ุงูุนุงุฆู ุงูุชุฑุงุถูุงู ุนูู ุงูุฏูุณูุชูุจ ูุฅุนุทุงุก ูุณุงุญุฉ ุฃูุจุฑ */
        @media (min-width: 768px) {
            #floating-cta-container {
                display: none !important;
            }
        }
    </style>
</head>
<body class="dir-rtl bg-gray-50">

    <!-- I. ุดุฑูุท ุงูุนุฑุถ ุงูุซุงุจุช (Sticky Offer Bar) -->
    <div id="sticky-offer-bar" class="bg-red-600 text-white text-center p-3 font-extrabold shadow-2xl">
        ๐จ **ุชูุจูู: ุงูุชูุตูู ูุฌุงูู 100% ุนูุฏ ุทูุจ 2 ููุชุฌ ุฃู ุฃูุซุฑ! ุงุจุฏุฃ ุงูุชูููุฑ ุงูุขู.**
    </div>

    <div class="container mx-auto p-4 md:p-8">

        <!-- II. ูุณู ุงูุจุทู (Hero Section) -->
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-5xl font-extrabold text-gray-800 mb-4">
                ุฌุฏุฏ ุบุฑูุชู ุจุฃูุงูุฉ: ุทูู ุงูุฏุฑุงุจ 6 ูุทุน (ุฌูุฏุฉ ุนุงููุฉ)
            </h1>
            
            <!-- ูุนุฑุถ ุตูุฑ ุงูููุชุฌุงุช ุงููุชุญุฑู (Carousel) -->
            <div id="product-carousel" class="relative w-full mx-auto max-w-lg overflow-hidden rounded-xl shadow-2xl h-[300px] md:h-[450px]">
                
                <!-- ุฑูุงุจุท ุงูุตูุฑ ุงููุคูุชุฉ (ุณูุชู ุงุณุชุจุฏุงููุง ุจุฑูุงุจุท GitHub ุงููุจุงุดุฑุฉ) -->
                <img src="d97fac73-817d-4326-a8bd-aeea7d6f7811.jpeg" data-model="Crimson-Red" alt="ุทูู ูุฑุฏู/ุฃุญูุฑ" class="carousel-item active w-full h-full object-cover">
<img src="de59d788-c19f-4861-8905-0361e248d21a-768x1365.jpeg" data-model="Deep-Blue" alt="ุทูู ุฑูุงุฏู/ุฃุฒุฑู" class="carousel-item w-full h-full object-cover">
<img src="532fbbe4-82be-4e68-a35f-ae5efc1c483b-768x1365.jpeg" data-model="Emerald-Green" alt="ุทูู ุฑูุงุฏู/ุฃุณูุฏ" class="carousel-item w-full h-full object-cover">
<img src="f21c3d80-5a31-4e84-89e9-5402f4e90cc2-768x1365.jpeg" data-model="Royal-Purple" alt="ุทูู ุจูู/ุจูุฌ" class="carousel-item w-full h-full object-cover">
                <!-- ูุคุดุฑุงุช ุงูุชููู ุงูุชููุงุฆู -->
                <div id="carousel-dots" class="absolute bottom-4 w-full flex justify-center space-x-2 space-x-reverse">
                    <!-- ูุชู ุชูููุฏ ุงูููุงุท ุจูุงุณุทุฉ JS -->
                </div>
            </div>
        </header>
        
        <!-- III. ูุญุฏุฏ ุงููููุฉ ูุงูููุฏูู (The Offer Builder) -->
        <section id="order-builder" class="order-builder mb-10 p-5 bg-white rounded-xl shadow-2xl">
            <h2 class="text-3xl font-bold text-gray-800 border-b-4 border-blue-600 pb-2 mb-6">
                1. ุงุฎุชุฑ ููุฏููุงุชู ุงูุขู:
            </h2>
            
            <!-- ุจุทุงูุงุช ุงูููุฏููุงุช (Grid) - Grid Items now have consistent height -->
            <div id="models-container" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                
                <!-- ุงูููุฏูู 1 -->
                <div class="model-card p-3 bg-blue-50 rounded-xl" data-model="Crimson-Red" data-price="4300">
                    <div class="model-card-content">
                        <!-- ุงููุณู ุงูุนููู -->
                        <div>
                            <!-- ุงูุตูุฑุฉ ุงููุคูุชุฉ -->
                            img src="d97fac73-817d-4326-a8bd-aeea7d6f7811.jpeg" alt="ุทูู ูุฑุฏู/ุฃุญูุฑ" class="w-full h-auto rounded-lg mb-2 object-cover aspect-square shadow-md">
</div>
                        <!-- ุงูุชุญูู ูู ุงููููุฉ (ุงููุณู ุงูุณููู) -->
                        <div class="quantity-control flex justify-center items-center mt-auto">
                            <button class="qty-btn rounded-r-lg p-2 bg-blue-600 hover:bg-blue-700 text-white" data-action="minus" disabled>-</button>
                            <span class="qty-value text-xl font-bold px-3 border-t border-b border-gray-300 bg-white min-w-[40px] text-center">0</span>
                            <button class="qty-btn rounded-l-lg p-2 bg-blue-600 hover:bg-blue-700 text-white" data-action="plus">+</button>
                        </div>
                    </div>
                </div>

                <!-- ุงูููุฏูู 2 -->
                <div class="model-card p-3 bg-blue-50 rounded-xl" data-model="Deep-Blue" data-price="4300">
                    <div class="model-card-content">
                        <!-- ุงููุณู ุงูุนููู -->
                        <div>
                            <!-- ุงูุตูุฑุฉ ุงููุคูุชุฉ -->
                            <img src="https://placehold.co/300x300/3B82F6/ffffff?text=Model+A2" alt="ุทูู ุฑูุงุฏู/ุฃุฒุฑู" class="w-full h-auto rounded-lg mb-2 object-cover aspect-square shadow-md">
                            <h3 class="font-bold text-lg mb-1">ููุฏูู A2 - ุงูุฑูุงุฏู/ุงูุฃุฒุฑู</h3>
                            <p class="text-gray-700 font-bold mb-3">4,300 ุฏ.ุฌ</p>
                        </div>
                        <!-- ุงูุชุญูู ูู ุงููููุฉ (ุงููุณู ุงูุณููู) -->
                        <div class="quantity-control flex justify-center items-center mt-auto">
                            <button class="qty-btn rounded-r-lg p-2 bg-blue-600 hover:bg-blue-700 text-white" data-action="minus" disabled>-</button>
                            <span class="qty-value text-xl font-bold px-3 border-t border-b border-gray-300 bg-white min-w-[40px] text-center">0</span>
                            <button class="qty-btn rounded-l-lg p-2 bg-blue-600 hover:bg-blue-700 text-white" data-action="plus">+</button>
                        </div>
                    </div>
                </div>

                <!-- ุงูููุฏูู 3 -->
                <div class="model-card p-3 bg-blue-50 rounded-xl" data-model="Emerald-Green" data-price="4300">
                    <div class="model-card-content">
                        <!-- ุงููุณู ุงูุนููู -->
                        <div>
                            <!-- ุงูุตูุฑุฉ ุงููุคูุชุฉ -->
                            <img src="https://placehold.co/300x300/10B981/ffffff?text=Model+A3" alt="ุทูู ุฑูุงุฏู/ุฃุณูุฏ" class="w-full h-auto rounded-lg mb-2 object-cover aspect-square shadow-md">
                            <h3 class="font-bold text-lg mb-1">ููุฏูู A3 - ุงูุฑูุงุฏู/ุงูุฃุณูุฏ</h3>
                            <p class="text-gray-700 font-bold mb-3">4,300 ุฏ.ุฌ</p>
                        </div>
                        <!-- ุงูุชุญูู ูู ุงููููุฉ (ุงููุณู ุงูุณููู) -->
                        <div class="quantity-control flex justify-center items-center mt-auto">
                            <button class="qty-btn rounded-r-lg p-2 bg-blue-600 hover:bg-blue-700 text-white" data-action="minus" disabled>-</button>
                            <span class="qty-value text-xl font-bold px-3 border-t border-b border-gray-300 bg-white min-w-[40px] text-center">0</span>
                            <button class="qty-btn rounded-l-lg p-2 bg-blue-600 hover:bg-blue-700 text-white" data-action="plus">+</button>
                        </div>
                    </div>
                </div>

                <!-- ุงูููุฏูู 4 -->
                <div class="model-card p-3 bg-blue-50 rounded-xl" data-model="Royal-Purple" data-price="4300">
                    <div class="model-card-content">
                        <!-- ุงููุณู ุงูุนููู -->
                        <div>
                            <!-- ุงูุตูุฑุฉ ุงููุคูุชุฉ -->
                            <img src="https://placehold.co/300x300/8B5CF6/ffffff?text=Model+A4" alt="ุทูู ุจูู/ุจูุฌ" class="w-full h-auto rounded-lg mb-2 object-cover aspect-square shadow-md">
                            <h3 class="font-bold text-lg mb-1">ููุฏูู A4 - ุงูุจูู/ุงูุจูุฌ</h3>
                            <p class="text-gray-700 font-bold mb-3">4,300 ุฏ.ุฌ</p>
                        </div>
                        <!-- ุงูุชุญูู ูู ุงููููุฉ (ุงููุณู ุงูุณููู) -->
                        <div class="quantity-control flex justify-center items-center mt-auto">
                            <button class="qty-btn rounded-r-lg p-2 bg-blue-600 hover:bg-blue-700 text-white" data-action="minus" disabled>-</button>
                            <span class="qty-value text-xl font-bold px-3 border-t border-b border-gray-300 bg-white min-w-[40px] text-center">0</span>
                            <button class="qty-btn rounded-l-lg p-2 bg-blue-600 hover:bg-blue-700 text-white" data-action="plus">+</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ุดุฑูุท ุงูุชูุฏู ุงูุจุตุฑู -->
            <div class="mt-8 bg-gray-200 rounded-full h-8 relative overflow-hidden shadow-inner">
                <div id="progress-bar-fill" class="h-full absolute rounded-full bg-yellow-400" style="width: 0%;"></div>
                <p id="progress-message" class="absolute inset-0 text-center text-sm font-black text-gray-800 flex items-center justify-center px-4">
                    ุฃุถู ููุฏูู ูุงุญุฏ ุนูู ุงูุฃูู ููุจุฏุก.
                </p>
            </div>
        </section>

        <!-- ุตูุฏูู ุงูุณุนุฑ -->
        <div class="text-center mb-10">
            <div class="inline-block p-4 rounded-xl bg-white shadow-2xl border-4 border-red-500">
                <p class="text-lg text-gray-500 line-through">ุงูุณุนุฑ ุงูุฃุตูู: 4800 ุฏ.ุฌ</p>
                <p class="text-4xl font-black text-red-600">4,300.00 ุฏ.ุฌ</p>
                <p class="text-sm text-gray-500 font-semibold mt-1">ุณุนุฑ ุงูููุฏูู ุงููุงุญุฏ (ุดุงูู ูู ุงูุฑุณูู)</p>
            </div>
        </div>

        <!-- IV. ูููุฐุฌ ุงูุดุญู ูููุฎุต ุงูุทูุจ (Checkout Form) -->
        <section id="checkout-section" class="checkout-form p-6 bg-white rounded-xl shadow-2xl">
            <h2 class="text-3xl font-bold text-gray-800 border-b-4 border-blue-600 pb-2 mb-6">
                2. ุฃููู ูุนูููุงุชู ูุงุณุชูู ุทูุจู:
            </h2>
            
            <div class="grid grid-cols-1 md:form-grid gap-6">
                
                <!-- ุนููุฏ ุงููููุฐุฌ (Form Column) - ูุจูู ุนูู ุงููููู (ูู RTL) -->
                <form id="order-form" action="#" method="POST" class="space-y-4">
                    <input type="text" name="full_name" placeholder="ุงูุงุณู ุจุงููุงูู" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-600 focus:border-blue-600 shadow-sm">
                    <input type="tel" name="phone" id="phone-input" placeholder="ุฑูู ุงููุงุชู (ุถุฑูุฑู ููุชุฃููุฏ)" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-600 focus:border-blue-600 shadow-sm">
                    
                    <select id="wilaya-select" name="wilaya" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-600 focus:border-blue-600 shadow-sm">
                        <option value="">-- ุงุฎุชุฑ ุงูููุงูุฉ --</option>
                        <!-- ูุชู ููุคูุง ุจูุงุณุทุฉ JS -->
                    </select>

                    <select id="baladiya-select" name="baladiya" required disabled class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-600 focus:border-blue-600 bg-gray-100 shadow-sm">
                        <option value="">-- ุงุฎุชุฑ ุงูุจูุฏูุฉ (ุจุนุฏ ุงุฎุชูุงุฑ ุงูููุงูุฉ) --</option>
                    </select>

                    <textarea name="notes" placeholder="ููุงุญุธุงุช ุฅุถุงููุฉ (ุงุฎุชูุงุฑู)" rows="2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-600 focus:border-blue-600 shadow-sm"></textarea>
                    
                    <!-- ุฒุฑ ุชุฃููุฏ ุงูุทูุจ ุงูููุงุฆู (CTA ุงูุซุงุจุช ุฏุงุฎู ุงููููุฐุฌ) -->
                    <button type="submit" form="order-form" id="cta-button" disabled class="cta-final-button w-full bg-gray-400 text-white p-4 rounded-xl font-extrabold text-2xl mt-4 shadow-xl cursor-not-allowed transition duration-300">
                        ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ููุชุฌ ูุงุญุฏ ุนูู ุงูุฃูู
                    </button>
                </form>

                <!-- ุนููุฏ ุงูููุฎุต (Summary Column) - ูุจูู ุนูู ุงููุณุงุฑ (ูู RTL) -->
                <div class="order-summary-box summary-box p-5 rounded-xl h-fit shadow-inner md:order-first"> 
                    <h3 class="text-2xl font-black mb-5 text-blue-700 border-b-2 border-blue-300 pb-2">ููุฎุต ูุงุชูุฑุชู</h3>
                    
                    <div class="space-y-3 text-lg">
                        <div class="summary-line flex justify-between">
                            <span class="text-gray-600">ุงููุฌููุน ุงููุฑุนู:</span>
                            <span id="sub-total" class="font-extrabold text-gray-800">0.00 ุฏ.ุฌ</span>
                        </div>
                        
                        <div class="summary-line shipping-line flex justify-between">
                            <span class="text-gray-600">ุฑุณูู ุงูุชูุตูู:</span>
                            <span id="shipping-cost" class="font-extrabold text-red-500">500.00 ุฏ.ุฌ</span>
                        </div>
                    </div>

                    <div class="total-line flex justify-between pt-5 mt-5 border-t-2 border-dashed border-blue-400">
                        <span class="text-xl font-black text-blue-800">ุงูุฅุฌูุงูู ุงูููุงุฆู:</span>
                        <span id="final-total" class="text-3xl font-black text-blue-700">0.00 ุฏ.ุฌ</span>
                    </div>

                    <!-- ุฑุณุงูุฉ ุงูุชูููุฑ (ุชุธูุฑ ููุท ุนูุฏ ุงูุดุญู ุงููุฌุงูู) -->
                    <div id="shipping-save-msg" class="bg-green-100 text-center p-3 mt-4 rounded-lg border-2 border-green-400 shadow-sm" style="display:none;">
                        <p class="text-green-700 font-extrabold text-lg">ููุฏ ูููุฑุช 500 ุฏ.ุฌ (ุดุญู ูุฌุงูู!)</p>
                    </div>
                </div>
            </div>

        </section>

        <!-- V. ูุณู ุงูุซูุฉ -->
        <section class="trust-section text-center my-10 p-5 bg-white rounded-xl shadow-2xl">
            <h3 class="text-2xl font-bold text-gray-700 mb-4">ููุงุฐุง ุชุดุชุฑู ููุงุ</h3>
            <div class="guarantees flex flex-wrap justify-center space-x-4 space-x-reverse text-gray-700 font-semibold">
                <span class="flex items-center p-3 m-1 bg-blue-100 rounded-full shadow-md">โ ุฏูุน ุจุนุฏ ุงูุงุณุชูุงู</span>
                <span class="flex items-center p-3 m-1 bg-blue-100 rounded-full shadow-md">๐ ุถูุงู ุฌูุฏุฉ ุงูููุชุฌ</span>
                <span class="flex items-center p-3 m-1 bg-blue-100 rounded-full shadow-md">๐ ุชูุตูู ุณุฑูุน ููู ุงูููุงูุงุช</span>
            </div>
        </section>

    </div>

    <!-- ุงูุฒุฑ ุงูุนุงุฆู (Floating CTA) - ูุธูุฑ ุนูู ุงูููุงุชู ููุท - ุงูููู ุงูุฃุฒุฑู ุงูููุญุฏ -->
    <div id="floating-cta-container">
        <button id="floating-cta-button" disabled class="w-full bg-gray-400 text-white p-4 rounded-xl font-extrabold text-xl shadow-2xl cursor-not-allowed transition duration-300">
            ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ููุชุฌ ูุงุญุฏ ุนูู ุงูุฃูู (ุงููุฑ ููุงูุชูุงู ููุฏูุน)
        </button>
    </div>

    <script>
        // --- ูุชุบูุฑุงุช ุงูุฃุณุนุงุฑ ูุงูุญุฏูุฏ ---
        const MODEL_PRICE = 4300; 
        const SHIPPING_COST = 500; 
        const FREE_SHIPPING_THRESHOLD = 2; // ุชูุตูู ูุฌุงูู ุนูุฏ 2 ููุชุฌ ุฃู ุฃูุซุฑ
        const CONTACT_PHONE = '0776587890'; // ุฑูู ูุงุชู ุฎุฏูุฉ ุงูุนููุงุก

        // --- ุนูุงุตุฑ DOM ---
        const modelsContainer = document.getElementById('models-container');
        const subTotalElement = document.getElementById('sub-total');
        const shippingCostElement = document.getElementById('shipping-cost');
        const finalTotalElement = document.getElementById('final-total');
        const shippingSaveMsg = document.getElementById('shipping-save-msg');
        const progressBarFill = document.getElementById('progress-bar-fill');
        const progressMessage = document.getElementById('progress-message');
        const ctaButton = document.getElementById('cta-button'); // ุงูุฒุฑ ุงูุซุงุจุช
        const floatingCtaContainer = document.getElementById('floating-cta-container');
        const floatingCtaButton = document.getElementById('floating-cta-button'); // ุงูุฒุฑ ุงูุนุงุฆู
        const checkoutSection = document.getElementById('checkout-section'); // ูุณู ุงูุฏูุน
        const wilayaSelect = document.getElementById('wilaya-select');
        const baladiyaSelect = document.getElementById('baladiya-select');
        const orderForm = document.getElementById('order-form');
        const carousel = document.getElementById('product-carousel');
        const carouselItems = Array.from(carousel.querySelectorAll('.carousel-item'));
        const carouselDotsContainer = document.getElementById('carousel-dots');
        
        let totalQuantity = 0;
        let selectedModels = {}; 
        let finalTotalDisplayValue = '0.00 ุฏ.ุฌ'; 
        let autoSlideInterval;

        // --- ุฏุงูุฉ ุชูุณูู ุงูุนููุฉ ---
        function formatCurrency(amount) {
            // ุงุณุชุฎุฏุงู Locale 'ar-DZ' ูุชูุณูู ุงูุฃุฑูุงู ุงูุฌุฒุงุฆุฑูุฉ (ุงุฎุชูุงุฑู)
            return `${amount.toLocaleString('ar-DZ')} ุฏ.ุฌ`;
        }

        // --- ูุธุงุฆู ุงูู Carousel ---

        function initCarousel() {
            // ุชูููุฏ ููุงุท ุงูุชููู
            carouselItems.forEach((item, index) => {
                const dot = document.createElement('span');
                dot.className = `w-3 h-3 bg-white rounded-full mx-1 opacity-50 cursor-pointer transition-opacity duration-300`;
                dot.dataset.index = index;
                dot.addEventListener('click', () => {
                    clearInterval(autoSlideInterval); 
                    showSlide(index);
                });
                carouselDotsContainer.appendChild(dot);
            });
            showSlide(0); 
            startAutoSlide();
        }

        function showSlide(index) {
            carouselItems.forEach((item, i) => {
                item.classList.remove('active');
                const dot = carouselDotsContainer.children[i];
                if (dot) {
                    dot.classList.remove('opacity-100', 'shadow-lg'); 
                    dot.classList.add('opacity-50');
                }
            });

            if (carouselItems[index]) {
                carouselItems[index].classList.add('active');
                const targetDot = carouselDotsContainer.children[index];
                if (targetDot) {
                    targetDot.classList.add('opacity-100', 'shadow-lg');
                    targetDot.classList.remove('opacity-50');
                }
            }
        }
        
        function startAutoSlide() {
            clearInterval(autoSlideInterval);
            autoSlideInterval = setInterval(() => {
                const activeIndex = carouselItems.findIndex(item => item.classList.contains('active'));
                const nextSlide = (activeIndex + 1) % carouselItems.length;
                showSlide(nextSlide);
            }, 5000); 
        }

        function showModelImage(modelName) {
            clearInterval(autoSlideInterval);
            const targetIndex = carouselItems.findIndex(item => item.dataset.model === modelName);
            if (targetIndex !== -1) {
                showSlide(targetIndex);
            }
        }

        function resetCarouselToAuto() {
            const hasSelection = totalQuantity > 0;
            if (!hasSelection) {
                showSlide(0);
                startAutoSlide();
            }
        }

        // --- ูุธุงุฆู ุชุญุฏูุซ ุณูุฉ ุงูุชุณูู ---

        function updateCart() {
            totalQuantity = 0;
            let subTotal = 0;
            let shippingCost = SHIPPING_COST;
            let firstSelectedModel = null;
            
            // ุญุณุงุจ ุงููููุฉ ุงูุฅุฌูุงููุฉ ูุงููุฌููุน ุงููุฑุนู
            for (const model in selectedModels) {
                const qty = selectedModels[model];
                totalQuantity += qty;
                subTotal += qty * MODEL_PRICE;
                if (qty > 0 && !firstSelectedModel) {
                    firstSelectedModel = model;
                }
            }
            
            // ุชุญุฏูุซ Carousel
            if (firstSelectedModel) {
                showModelImage(firstSelectedModel);
            } else {
                resetCarouselToAuto();
            }

            // ุชุญุฏูุฏ ุชูููุฉ ุงูุดุญู
            let isFreeShipping = totalQuantity >= FREE_SHIPPING_THRESHOLD;
            if (isFreeShipping) {
                shippingCost = 0;
            }

            const finalTotal = subTotal + shippingCost;
            finalTotalDisplayValue = formatCurrency(finalTotal);

            // 1. ุชุญุฏูุซ ุงูููุฎุต
            subTotalElement.textContent = formatCurrency(subTotal);
            finalTotalElement.textContent = finalTotalDisplayValue;
            
            // 2. ุชุญุฏูุซ ุฑุณูู ุงูุดุญู ูุฑุณุงูุฉ ุงูุชูููุฑ
            if (isFreeShipping) {
                shippingCostElement.textContent = `0.00 ุฏ.ุฌ`;
                shippingCostElement.className = 'font-extrabold text-green-600';
                shippingSaveMsg.style.display = 'block';
            } else {
                shippingCostElement.textContent = formatCurrency(SHIPPING_COST);
                shippingCostElement.className = 'font-extrabold text-red-500';
                shippingSaveMsg.style.display = 'none';
            }

            // 3. ุชุญุฏูุซ ุดุฑูุท ุงูุชูุฏู ูุฒุฑ ุงูู CTA
            updateProgressBar(totalQuantity, finalTotalDisplayValue);
        }

        function updateProgressBar(qty, finalTotalDisplay) {
            let percentage = 0;
            let message = '';
            let barColor = 'bg-yellow-400';
            let isEnabled = false;

            if (qty === 0) {
                percentage = 0;
                message = `ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ููุชุฌ ูุงุญุฏ ุนูู ุงูุฃูู!`;
            } else if (qty === 1) {
                percentage = 50;
                message = `ุฃุถู ููุชุฌ ุขุฎุฑ ูู **ุดุญู ูุฌุงูู!** (ุจุงูู ููุชุฌ ูุงุญุฏ)`;
                barColor = 'bg-blue-600'; // ุงุณุชุฎุฏุงู ุงูุฃุฒุฑู ูููุฑุญูุฉ ุงูุฃููู
                isEnabled = true;
            } else {
                percentage = 100;
                message = `ุชูุงูููุง! ููุฏ ุญุตูุช ุนูู ุชูุตูู ูุฌุงูู ููุฑู!`;
                barColor = 'bg-green-600';
                isEnabled = true;
            }
            
            const ctaText = isEnabled 
                ? `ุฃูุฏ ุทูุจู ุงูุขู: ${finalTotalDisplay} ${qty >= 2 ? '(ุชูุตูู ูุฌุงูู!)' : ''}`
                : 'ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ููุชุฌ ูุงุญุฏ ุนูู ุงูุฃูู';


            progressBarFill.style.width = `${percentage}%`;
            progressBarFill.className = `h-full absolute rounded-full ${barColor}`;
            progressMessage.innerHTML = message;
            
            // ุชุญุฏูุซ ุญุงูุฉ ูุฃุฒุฑุงุฑ CTA (ุงูุซุงุจุช ูุงูุนุงุฆู) - ุงุณุชุฎุฏุงู ุงูููู ุงูุฃุฒุฑู ุงูููุญุฏ
            [ctaButton, floatingCtaButton].forEach(btn => {
                btn.disabled = !isEnabled;
                btn.textContent = isEnabled ? ctaText : 'ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ููุชุฌ ูุงุญุฏ ุนูู ุงูุฃูู';
                
                if (isEnabled) {
                    btn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                    // ุชู ุชุบููุฑ ุงูููู ุฅูู ุงูุฃุฒุฑู ุงูุฏุงูู ููุชูุงุณู ูุน ุงููููุฐุฌ
                    btn.classList.add('bg-blue-700', 'hover:bg-blue-800'); 
                } else {
                    btn.classList.add('bg-gray-400', 'cursor-not-allowed');
                    btn.classList.remove('bg-blue-700', 'hover:bg-blue-800');
                }
            });
            
            // ุงูุชุญูู ูู ุธููุฑ ุงูุฒุฑ ุงูุนุงุฆู ุงูุฌุฏูุฏ
            if (window.innerWidth < 768) {
                floatingCtaContainer.classList.toggle('visible', isEnabled);
            }

            progressMessage.classList.toggle('text-white', percentage >= 50);
            progressMessage.classList.toggle('text-gray-800', percentage < 50);
        }
        
        // --- ูุงุนุฏุฉ ุจูุงูุงุช ุงูููุงูุงุช ูุงูุจูุฏูุงุช (58 ููุงูุฉ) ---
        const algeriaCities = {
            "01": { name: "ุฃุฏุฑุงุฑ", baladiyat: ["ุฃุฏุฑุงุฑ", "ุชููุทูุท", "ูููุบูู", "ุฑูุบุงู", "ุชูููููู", "ุฃููู", "ุจุฑุฌ ุจุงุฌู ูุฎุชุงุฑ"] },
            "02": { name: "ุงูุดูู", baladiyat: ["ุงูุดูู", "ุงููุฑุณู", "ุชูุณ", "ุฃุจู ุงูุญุณู", "ุงูููุนุฉ", "ูุงุฏู ุงููุถุฉ", "ุฃููุงุฏ ูุงุฑุณ"] },
            "03": { name: "ุงูุฃุบูุงุท", baladiyat: ["ุงูุฃุบูุงุท", "ูุตุฑ ุงูุญูุฑุงู", "ุนูู ูุงุถู", "ุชุงุฌููุช", "ุงูุฎูู"] },
            "04": { name: "ุฃู ุงูุจูุงูู", baladiyat: ["ุฃู ุงูุจูุงูู", "ุนูู ุงูุจูุถุงุก", "ุนูู ููููุฉ", "ุนูู ููุฑูู", "ูุณููุงูุฉ", "ุณูููุณ"] },
            "05": { name: "ุจุงุชูุฉ", baladiyat: ["ุจุงุชูุฉ", "ุจุฑููุฉ", "ูุฑูุงูุฉ", "ุฃุฑูุณ", "ุนูู ุงูุชูุชุฉ", "ุงูุดูุฑุฉ"] },
            "06": { name: "ุจุฌุงูุฉ", baladiyat: ["ุจุฌุงูุฉ", "ุฃููุงุฏู", "ุงููุตุฑ", "ุณูุฏู ุนูุด", "ุฃููุงุณ", "ููุจู", "ุชุงุฒูุงูุช"] },
            "07": { name: "ุจุณูุฑุฉ", baladiyat: ["ุจุณูุฑุฉ", "ุฃูุฑูุงู", "ุณูุฏู ุฎุงูุฏ", "ุทูููุฉ", "ุณูุฏู ุนูุจุฉ", "ุงูููุทุฑุฉ"] },
            "08": { name: "ุจุดุงุฑ", baladiyat: ["ุจุดุงุฑ", "ุงูุนุจุงุฏูุฉ", "ุจูู ูููู", "ูุญูุฑ", "ุชูุฏูู"] },
            "09": { name: "ุงูุจููุฏุฉ", baladiyat: ["ุงูุจููุฏุฉ", "ุงูุดุจูู", "ุงูุนูุฑูู", "ููุฒุงูุฉ", "ุงูุดูุฉ", "ุจูู ูุฑุงุฏ"] },
            "10": { name: "ุงูุจููุฑุฉ", baladiyat: ["ุงูุจููุฑุฉ", "ุณูุฑ ุงูุบุฒูุงู", "ุงูุฃุฎุถุฑูุฉ", "ุจุดููู", "ูุงุฏุฑูุฉ", "ุนูู ุจุณุงู"] },
            "11": { name: "ุชููุฑุงุณุช", baladiyat: ["ุชููุฑุงุณุช", "ุนูู ุตุงูุญ", "ุฅุฏูุณ", "ุชุงูููุงุช", "ุชูููุงููู"] },
            "12": { name: "ุชุจุณุฉ", baladiyat: ["ุชุจุณุฉ", "ุงูุดุฑูุนุฉ", "ุจุฆุฑ ุงูุนุงุชุฑ", "ุงูุนูููุงุช", "ุงููุงู ุงูุฃุจูุถ"] },
            "13": { name: "ุชููุณุงู", baladiyat: ["ุชููุณุงู", "ูุบููุฉ", "ุณุจุฏู", "ููุฏุฑููุฉ", "ุงูุบุฒูุงุช", "ุนูู ูุฒุฉ"] },
            "14": { name: "ุชูุงุฑุช", baladiyat: ["ุชูุงุฑุช", "ุนูู ุงูุฐูุจ", "ูุงุฏูุฉ", "ุงูุณููุฑ", "ูุบููุฉ"] },
            "15": { name: "ุชูุฒู ูุฒู", baladiyat: ["ุชูุฒู ูุฒู", "ุฐุฑุงุน ุงูููุฒุงู", "ุนุฒุงุฒูุฉ", "ุชูุฒู ุบููู", "ุจูุบูู", "ุงูุฃุฑุจุนุงุก ูุงุซ ุฅูุฑุงุซู"] },
            "16": { name: "ุงูุฌุฒุงุฆุฑ", baladiyat: ["ุงูุฌุฒุงุฆุฑ ุงููุณุทู", "ุจุงุจ ุงููุงุฏ", "ุจุฆุฑ ูุฑุงุฏ ุฑุงูุณ", "ุงูุฏุงุฑ ุงูุจูุถุงุก", "ุงูุดุฑุงูุฉ", "ุจุฑุงูู"] },
            "17": { name: "ุงูุฌููุฉ", baladiyat: ["ุงูุฌููุฉ", "ุนูู ูุณุงุฑุฉ", "ูุณุนุฏ", "ุญุงุณู ุจุญุจุญ", "ุงูุจูุฑูู"] },
            "18": { name: "ุฌูุฌู", baladiyat: ["ุฌูุฌู", "ุงูุทุงููุฑ", "ุงูููููุฉ", "ุฒูุงูุฉ ููุตูุฑูุฉ", "ุงูุดุญูุฉ"] },
            "19": { name: "ุณุทูู", baladiyat: ["ุณุทูู", "ุงูุนููุฉ", "ุจููุงุนุฉ", "ุนูู ูููุงู", "ุตุงูุญ ุจุงู", "ุนูู ุขุฒุงู"] },
            "20": { name: "ุณุนูุฏุฉ", baladiyat: ["ุณุนูุฏุฉ", "ุนูู ุงูุณุฎููุฉ", "ููุจ", "ุงูุญุณุงุณูุฉ"] },
            "21": { name: "ุณูููุฏุฉ", baladiyat: ["ุณูููุฏุฉ", "ุงููู", "ุนุฒุงุจุฉ", "ุงูุญุฑูุด", "ุชูุงููุณ"] },
            "22": { name: "ุณูุฏู ุจูุนุจุงุณ", baladiyat: ["ุณูุฏู ุจูุนุจุงุณ", "ุณููุฒู", "ุชูุงุบ", "ุฑุฃุณ ุงููุงุก", "ุนูู ุงูุจุฑุฏ"] },
            "23": { name: "ุนูุงุจุฉ", baladiyat: ["ุนูุงุจุฉ", "ุงูุจููู", "ุจุฑุญุงู", "ุณุฑุงูุฏู", "ุงูุญุฌุงุฑ"] },
            "24": { name: "ูุงููุฉ", baladiyat: ["ูุงููุฉ", "ูููููุจูููุณ", "ุจูุดููู", "ูุงุฏู ุงูุฒูุงุชู", "ุนูู ุญุณุงูููุฉ"] },
            "25": { name: "ูุณูุทููุฉ", baladiyat: ["ูุณูุทููุฉ", "ุงูุฎุฑูุจ", "ุนูู ุนุจูุฏ", "ุญุงูุฉ ุจูุฒูุงู", "ุฏูุฏูุด ูุฑุงุฏ"] },
            "26": { name: "ุงููุฏูุฉ", baladiyat: ["ุงููุฏูุฉ", "ุงูุจุฑูุงููุฉ", "ูุตุฑ ุงูุจุฎุงุฑู", "ุจูู ุณูููุงู", "ุงูุนูุงุฑูุฉ"] },
            "27": { name: "ูุณุชุบุงูู", baladiyat: ["ูุณุชุบุงูู", "ุญุงุณู ูุงูุงุด", "ุนูู ุชุงุฏูุณ", "ุฎูุฑ ุงูุฏูู", "ุจูููุฑุงุท"] },
            "28": { name: "ุงููุณููุฉ", baladiyat: ["ุงููุณููุฉ", "ุณูุฏู ุนูุณู", "ููุฑ", "ุจูุณุนุงุฏุฉ", "ุญูุงู ุงูุถูุนุฉ"] },
            "29": { name: "ูุนุณูุฑ", baladiyat: ["ูุนุณูุฑ", "ุชูุบููู", "ุงููุญูุฏูุฉ", "ุณูู", "ุบุฑูุณ"] },
            "30": { name: "ูุฑููุฉ", baladiyat: ["ูุฑููุฉ", "ุงูุฑููุณุงุช", "ุชูุฑุช", "ุญุงุณู ูุณุนูุฏ", "ุงูุจุฑูุฉ"] },
            "31": { name: "ููุฑุงู", baladiyat: ["ููุฑุงู", "ุฃุฑุฒูู", "ุจุทููุฉ", "ูุฏูู", "ุจุฆุฑ ุงูุฌูุฑ", "ุนูู ุงูุชุฑู"] },
            "32": { name: "ุงูุจูุถ", baladiyat: ["ุงูุจูุถ", "ุจููุทุจ", "ุจุฑูุฒููุฉ", "ุงูุฑูุงุตุฉ"] },
            "33": { name: "ุฅููุฒู", baladiyat: ["ุฅููุฒู", "ุฌุงูุช", "ุจุฑุฌ ุงูุญูุงุณ"] },
            "34": { name: "ุจุฑุฌ ุจูุนุฑูุฑูุฌ", baladiyat: ["ุจุฑุฌ ุจูุนุฑูุฑูุฌ", "ุฑุฃุณ ุงููุงุฏู", "ูุฌูุงูุฉ", "ุงูููุตูุฑุฉ", "ุงูุญูุงุฏูุฉ"] },
            "35": { name: "ุจููุฑุฏุงุณ", baladiyat: ["ุจููุฑุฏุงุณ", "ุฏูุณ", "ุงูุซููุฉ", "ููุฑุตู", "ูุณุฑ"] },
            "36": { name: "ุงูุทุงุฑู", baladiyat: ["ุงูุทุงุฑู", "ุจูุญุฌุงุฑ", "ุงูุฒูุชููุฉ", "ุงููุงูุฉ"] },
            "37": { name: "ุชูุฏูู", baladiyat: ["ุชูุฏูู"] },
            "38": { name: "ุชูุณูุณููุช", baladiyat: ["ุชูุณูุณููุช", "ุซููุฉ ุงูุญุฏ", "ุจุฑุฌ ุจููุนุงูุฉ"] },
            "39": { name: "ุงููุงุฏู", baladiyat: ["ุงููุงุฏู", "ููุงุฑ", "ุญุณุงูู ุนุจุฏ ุงููุฑูู", "ุงูุฒุงููุฉ ุงูุนุงุจุฏูุฉ"] },
            "40": { name: "ุฎูุดูุฉ", baladiyat: ["ุฎูุดูุฉ", "ุดุดุงุฑ", "ุนูู ุงูุทูููุฉ", "ูุงูุณ"] },
            "41": { name: "ุณูู ุฃูุฑุงุณ", baladiyat: ["ุณูู ุฃูุฑุงุณ", "ุงูุญุฏุงุฏุฉ", "ุฎููุณุฉ", "ุณุฏุฑุงุชุฉ"] },
            "42": { name: "ุชูุจุงุฒุฉ", baladiyat: ["ุชูุจุงุฒุฉ", "ุดุฑุดุงู", "ุงููููุนุฉ", "ูููุฉ", "ุญุฌูุท"] },
            "43": { name: "ูููุฉ", baladiyat: ["ูููุฉ", "ูุฑุฌููุฉ", "ุดูุบูู ุงูุนูุฏ", "ุชุงุฌูุงูุช"] },
            "44": { name: "ุนูู ุงูุฏููู", baladiyat: ["ุนูู ุงูุฏููู", "ุงูุนุจุงุฏูุฉ", "ุงูุฎููุณ", "ูููุงูุฉ"] },
            "45": { name: "ุงููุนุงูุฉ", baladiyat: ["ุงููุนุงูุฉ", "ุนูู ุงูุตูุฑุงุก", "ูุดุฑูุฉ", "ุตููุตููุฉ"] },
            "46": { name: "ุนูู ุชููุดูุช", baladiyat: ["ุนูู ุชููุดูุช", "ุจูู ุตุงู", "ุญูุงู ุจูุญุฌุฑ", "ูููุงุตุฉ"] },
            "47": { name: "ุบุฑุฏุงูุฉ", baladiyat: ["ุบุฑุฏุงูุฉ", "ุงููุฑุงุฑุฉ", "ุจุฑูุงู", "ุงููููุนุฉ", "ูุชูููู"] },
            "48": { name: "ุบููุฒุงู", baladiyat: ["ุบููุฒุงู", "ููู", "ูุงุฒููุฉ", "ูุงุฏู ุงุฑููู", "ุฒููุฑุฉ"] },
            "49": { name: "ุงููุบูุฑ", baladiyat: ["ุงููุบูุฑ", "ุฌุงูุนุฉ", "ุฃู ุงูุทููุฑ"] },
            "50": { name: "ุงููููุนุฉ", baladiyat: ["ุงููููุนุฉ", "ุญุงุณู ุงููุงุฑุฉ", "ุญุงุณู ููุญู"] },
            "51": { name: "ุฃููุงุฏ ุฌูุงู", baladiyat: ["ุฃููุงุฏ ุฌูุงู", "ุณูุฏู ุฎุงูุฏ", "ุงูุจุณุจุงุณ"] },
            "52": { name: "ุจุฑุฌ ุจุงุฌู ูุฎุชุงุฑ", baladiyat: ["ุจุฑุฌ ุจุงุฌู ูุฎุชุงุฑ"] },
            "53": { name: "ุจูู ุนุจุงุณ", baladiyat: ["ุจูู ุนุจุงุณ", "ุฅููู", "ุชุงูุชุฑุช"] },
            "54": { name: "ุชูููููู", baladiyat: ["ุชูููููู", "ุฃููุงุฏ ุณุนูุฏ", "ุดุฑููู"] },
            "55": { name: "ุชููุฑุช", baladiyat: ["ุชููุฑุช", "ุงููุฒูุฉ", "ุชุจุณุจุณุช"] },
            "56": { name: "ุฌุงูุช", baladiyat: ["ุฌุงูุช", "ุฅููู"] },
            "57": { name: "ุนูู ุตุงูุญ", baladiyat: ["ุนูู ุตุงูุญ", "ุฅุฏูุณ"] },
            "58": { name: "ุนูู ูุฒุงู", baladiyat: ["ุนูู ูุฒุงู", "ุชูู ุฒุงูุชู"] }
        };

        // --- ูุธุงุฆู ุงูููุงูุงุช ูุงูุจูุฏูุงุช ---
        
        function populateWilayat() {
            const sortedCities = Object.entries(algeriaCities).sort(([, a], [, b]) => a.name.localeCompare(b.name, 'ar'));
            
            sortedCities.forEach(([code, data]) => {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = data.name;
                wilayaSelect.appendChild(option);
            });
        }

        function populateBaladiyat(wilayaCode) {
            baladiyaSelect.innerHTML = '<option value="">-- ุงุฎุชุฑ ุงูุจูุฏูุฉ --</option>';
            
            if (wilayaCode && algeriaCities[wilayaCode]) {
                const baladiyat = algeriaCities[wilayaCode].baladiyat.sort((a, b) => a.localeCompare(b, 'ar'));
                baladiyat.forEach(baladiya => {
                    const option = document.createElement('option');
                    option.value = baladiya;
                    option.textContent = baladiya;
                    baladiyaSelect.appendChild(option);
                });
                baladiyaSelect.disabled = false;
                baladiyaSelect.classList.remove('bg-gray-100');
            } else {
                baladiyaSelect.disabled = true;
                baladiyaSelect.classList.add('bg-gray-100');
            }
        }
        
        // --- ูุธููุฉ ุงูุชุญูู ูู ุงูุฒุฑ ุงูุนุงุฆู ูุงูุฒุฑ ุงูุซุงุจุช ---
        function checkFloatingCtaVisibility() {
            // ุชุญูู ููุท ุฅุฐุง ูุงู ุงูุนุฑุถ ุนุฑุถ ููุจุงูู 
            if (window.innerWidth >= 768) {
                return;
            }
            
            // ูุฌุจ ุฃู ูููู ุงูุฒุฑ ูุฑุฆูุงู ููุท ุฅุฐุง ูุงูุช ููุงู ูููุฉ ูุฎุชุงุฑุฉ
            const isEnabled = totalQuantity > 0;
            
            const checkoutTop = checkoutSection.offsetTop;
            
            // ุงูุญุงูุฉ 1: ุชู ุงุฎุชูุงุฑ ููุชุฌุ ูููู ูู ูุตู ุงููุณุชุฎุฏู ุฅูู ูุณู ุงูุฏูุน ุจุนุฏ
            // ูุณุชุฎุฏู ููุท (window.scrollY < (checkoutTop - window.innerHeight / 2)) ูุชูุฑูุจ
            if (isEnabled && window.scrollY < (checkoutTop - (window.innerHeight / 2))) {
                floatingCtaContainer.classList.add('visible');
            } 
            // ุงูุญุงูุฉ 2: ูุตู ุงููุณุชุฎุฏู ุฅูู ูุณู ุงูุฏูุน (ุงุฎูู ุงูุฒุฑ ุงูุนุงุฆู) ุฃู ูู ูุฎุชุฑ ุฃู ููุชุฌ
            else {
                floatingCtaContainer.classList.remove('visible');
            }
        }

        // --- ุงููุนุงูุฌุงุช ูุงูุฃุญุฏุงุซ ---
        
        // ุญุฏุซ ุงูุชุญูู ุจุงููููุฉ
        modelsContainer.addEventListener('click', (event) => {
            const button = event.target.closest('.qty-btn');
            if (!button) return;

            const card = button.closest('.model-card');
            const modelName = card.dataset.model;
            const qtySpan = card.querySelector('.qty-value');
            let currentQty = parseInt(qtySpan.textContent);
            const action = button.dataset.action;

            if (action === 'plus') {
                currentQty++;
            } else if (action === 'minus' && currentQty > 0) {
                currentQty--;
            }

            qtySpan.textContent = currentQty;
            selectedModels[modelName] = currentQty;

            card.querySelector('[data-action="minus"]').disabled = currentQty === 0;
            card.classList.toggle('active', currentQty > 0);

            updateCart();
            // ููู: ูุญุต ุญุงูุฉ ุงูุฒุฑ ุงูุนุงุฆู ุจุนุฏ ูู ุชุญุฏูุซ ููุนุฑุจุฉ
            checkFloatingCtaVisibility(); 
        });

        // ุญุฏุซ ุงูููุฑ ุนูู ุงูุฒุฑ ุงูุนุงุฆู (ููุชูุฑูุฑ ุฅูู ูุณู ุงูุฏูุน)
        floatingCtaButton.addEventListener('click', () => {
             // ุงูุชุญูู ูู ูุฌูุฏ ูููุฉ ูุจู ุงูุชูุฑูุฑ
            if (totalQuantity > 0) {
                // ุงูุชูุฑูุฑ ุฅูู ูุณู ุงูุฏูุน ูุน ุชุฑู ูุงูุด ุจุณูุท ูู ุงูุฃุนูู
                window.scrollTo({ top: checkoutSection.offsetTop - 10, behavior: 'smooth' });
            }
        });

        // ุญุฏุซ ุงูุชูุฑูุฑ ููุชุญูู ูู ุงูุฒุฑ ุงูุนุงุฆู
        window.addEventListener('scroll', checkFloatingCtaVisibility);

        // ุญุฏุซ ุชุบููุฑ ุงูููุงูุฉ
        wilayaSelect.addEventListener('change', (e) => {
            populateBaladiyat(e.target.value);
        });

        // ุญุฏุซ ุฅุฑุณุงู ุงููููุฐุฌ
        orderForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            if (totalQuantity === 0) {
                console.error('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ููุชุฌ ูุงุญุฏ ุนูู ุงูุฃูู ูุจู ุชุฃููุฏ ุงูุทูุจ.');
                window.scrollTo({ top: document.getElementById('order-builder').offsetTop - 50, behavior: 'smooth' });
                return;
            }

            if (!wilayaSelect.value || !baladiyaSelect.value) {
                // ุจุฏูู ูู alert: ุชูุฑูุฑ ุฅูู ุญูู ุงูููุงูุฉ ูุน ุชุณููุท ุงูุถูุก ุนููู (ุฅู ุฃููู)
                wilayaSelect.focus();
                // ููููู ุงุณุชุฎุฏุงู ููุฏุงู ูุฎุตุต ุจุฏูุงู ูู alert ูู ุจูุฆุฉ ุฅูุชุงุฌูุฉ
                console.error('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุงูููุงูุฉ ูุงูุจูุฏูุฉ ุจุดูู ุตุญูุญ ูุฅุชูุงู ุงูุทูุจ.'); 
                return;
            }

            const form = e.target;
            const wilayaName = form.wilaya.options[form.wilaya.selectedIndex].textContent;
            
            // ุชุฌููุน ุจูุงูุงุช ุงูุทูุจ
            const orderDetails = {
                'ุงูุงุณู': form.full_name.value,
                'ุงููุงุชู': form.phone.value,
                'ุงูููุงูุฉ': wilayaName,
                'ุงูุจูุฏูุฉ': form.baladiya.value,
                'ููุงุญุธุงุช': form.notes.value,
                'ุงููููุฉ_ุงูุฅุฌูุงููุฉ': totalQuantity,
                'ุงูููุฏููุงุช_ุงููุฎุชุงุฑุฉ': JSON.stringify(selectedModels),
                'ุงูุฅุฌูุงูู_ุงูููุงุฆู': finalTotalDisplayValue,
                'ุชูููุฉ_ุงูุดุญู': document.getElementById('shipping-cost').textContent,
                // ูุชู ุชุฃููุฏ ุทุฑููุฉ ุงูุฏูุน ููุง ุจุดูู ุตุฑูุญ ูู ุงูุจูุงูุงุช ุงููุฑุณูุฉ (ูููููุง ุบูุฑ ูุนุฑูุถุฉ ูููุณุชุฎุฏู)
                'ุทุฑููุฉ_ุงูุฏูุน': 'ุงูุฏูุน ุนูุฏ ุงูุงุณุชูุงู (COD)' 
            };

            // 1. ุชุฎุฒูู ุงูุจูุงูุงุช ุงูุถุฑูุฑูุฉ ูู Local Storage ูุตูุญุฉ ุงูุดูุฑ (ูุญุงูุงุฉ)
            localStorage.setItem('orderFinalTotal', finalTotalDisplayValue);
            localStorage.setItem('orderPhone', form.phone.value);
            localStorage.setItem('confirmationNumber', CONTACT_PHONE);
            
            // 2. ุฅุฑุณุงู ุงูุจูุงูุงุช (ูุญุงูุงุฉ: ูู ุจูุฆุฉ ุญููููุฉุ ูุชู ุฅุฑุณุงููุง ููุง ุนุจุฑ Fetch API)
            console.log('Order Data:', orderDetails);
            
            // 3. ููุชูู ุญุงูููุง ุจุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ ุจุณูุทุฉ 
            const successMessageDiv = document.createElement('div');
            successMessageDiv.className = 'fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50';
            successMessageDiv.innerHTML = `
                <div class="bg-white p-8 rounded-xl shadow-2xl text-center max-w-sm mx-auto">
                    <h3 class="text-3xl font-extrabold text-green-600 mb-4">โ ุชู ุชุฃููุฏ ุงูุทูุจ!</h3>
                    <p class="text-gray-700 text-lg mb-4">ุณูุชู ุงูุงุชุตุงู ุจู ุนูู **${form.phone.value}** ูุชุฃููุฏ ุชูุงุตูู ุงูุดุญู.</p>
                    <p class="text-2xl font-black text-blue-700 mb-6">ุงูุฅุฌูุงูู: ${finalTotalDisplayValue}</p>
                    <button onclick="window.location.reload();" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg">ุญุณูุงูุ ูููุช</button>
                </div>
            `;
            document.body.appendChild(successMessageDiv);

        });

        // --- ุงูุชููุฆุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ ---
        window.onload = () => {
            modelsContainer.querySelectorAll('.model-card').forEach(card => {
                const modelName = card.dataset.model;
                selectedModels[modelName] = 0;
            });
            populateWilayat();
            initCarousel();
            updateCart();
            // ูุญุต ุงูุฑุคูุฉ ุงูุฃูููุฉ ููุฒุฑ ุงูุนุงุฆู (ูุฌุจ ุฃู ูููู ูุฎููุงู ูู ุงูุจุฏุงูุฉ)
            checkFloatingCtaVisibility();
        };

    </script>
</body>
</html>
